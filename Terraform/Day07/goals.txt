Objective â€” What Youâ€™re Actually Building

You are building:

A controlled Infrastructure delivery pipeline

Where:

Engineer â†’ PR â†’ Plan â†’ Review â†’ Approval â†’ Apply â†’ Audit

No direct apply.
No cowboy pushes.
No accidental production destruction.

Real-World Purpose

In real companies:

Terraform runs from pipelines

State is remote (never local)

PR validation prevents outages

Manual approval protects production

Audit trail proves compliance

If you can explain and implement this, you are employable.

ðŸ§ª Exercise 1 â€” Break Required Argument (Validation Must Fail)
ðŸŽ¯ Goal

Your Validate stage must fail before plan runs.

If it doesnâ€™t, your pipeline is weak.

Step 1 â€” Create a Feature Branch

Never break main.

git checkout -b feature/break-location

Step 2 â€” Remove location from main.tf

Change this:

resource "azurerm_resource_group" "demo" {
  name     = "rg-demo-test"
  location = "Central India"
}


To this:

resource "azurerm_resource_group" "demo" {
  name = "rg-demo-test"
}


Save.

Step 3 â€” Test Locally (Optional but Smart)

Run:

terraform validate


You should see something like:

The argument "location" is required, but no definition was found.


If you donâ€™t see failure locally, your provider config is broken.

Step 4 â€” Commit and Push
git add .
git commit -m "Test: remove location to break validation"
git push origin feature/break-location

Step 5 â€” Create PR

Open PR â†’ target main.

Expected Result:

Validate stage fails

Plan stage does NOT run

If plan runs â†’ your pipeline dependencies are wrong.

If everything passes â†’ your validate stage is incomplete.

Fix pipeline before moving forward.

ðŸ§ª Exercise 2 â€” Add Tag (Must Be In-Place Update)

Now we test lifecycle understanding.

Step 1 â€” Create New Branch
git checkout main
git pull
git checkout -b feature/add-tag

Step 2 â€” Modify Resource

Add tags:

resource "azurerm_resource_group" "demo" {
  name     = "rg-demo-test"
  location = "Central India"

  tags = {
    env = "dev"
  }
}

Step 3 â€” Local Plan

Run:

terraform plan

Expected Output:
~ update in-place


You should see:

~ tags = {
    + "env" = "dev"
  }


NOT:

-/+ resource will be destroyed and recreated


If it wants to recreate:

You changed name accidentally

You changed location

You changed provider config

Fix it.

Step 4 â€” Push PR
git add .
git commit -m "Add tag to RG"
git push origin feature/add-tag


Review PR plan output.

If it shows destroy/create, stop and understand why.

ðŸ§ª Exercise 3 â€” Change Resource Group Name (Controlled Destruction Detection)

Now we simulate a dangerous change.

Step 1 â€” New Branch
git checkout main
git pull
git checkout -b feature/change-rg-name

Step 2 â€” Change Name

From:

name = "rg-demo-test"


To:

name = "rg-demo-prod"

Step 3 â€” Run Plan
terraform plan

Expected Output:
-/+ destroy and create replacement


Terraform must show:

destroy rg-demo-test

create rg-demo-prod

This is correct behavior.

Azure does not allow renaming resource groups.

If plan shows only update â†’ something is wrong.

What You Just Learned

Changing immutable attributes = destruction.

This is exactly what PR plan review is meant to catch.

In real production, this would wipe everything inside the RG.

ðŸ§ª Exercise 4 â€” Protect Main Branch (This Is Governance)

This is not Terraform. This is DevOps maturity.

Step 1 â€” Go to Azure DevOps

Repos â†’ Branches â†’ main â†’ Branch policies.

Step 2 â€” Enable:

âœ… Require minimum reviewers (at least 1)

âœ… Check for linked work items (optional but good)

âœ… Require successful build validation

âœ… Reset code reviewer votes when new changes pushed

âœ… Block direct pushes

Most important:
Disable â€œAllow direct pushesâ€.

Step 3 â€” Test It

Try:

git checkout main
echo "test" >> test.txt
git add .
git commit -m "test direct push"
git push origin main


It must fail.

If it succeeds:

Your governance is fake.

What You Should See After All 4
Exercise	Expected Outcome
Break location	Validate stage fails
Add tag	In-place update
Change name	Destroy/Create
Protect main	Direct push blocked

If any of these donâ€™t behave exactly as expected:

Donâ€™t move forward.

Investigate why.